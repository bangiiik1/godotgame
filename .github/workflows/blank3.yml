name: ğŸ“± Build Android Debug APK

on:
  workflow_dispatch:

jobs:
  build-apk:
    name: ğŸ”§ Build APK
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ›’ Checkout project
        uses: actions/checkout@v4

      - name: ğŸ“¥ Download Godot 4.4.1 headless
        run: |
          curl -L -o godot.zip https://downloads.tuxfamily.org/godotengine/4.4.1/Godot_v4.4.1-stable_linux.headless.64.zip
          unzip godot.zip
          chmod +x Godot_v4.4.1-stable_linux.headless.64
          mkdir -p ~/.local/share/godot/templates/4.4.1.stable
          rm godot.zip  # ğŸ§¹ ÑÑ€Ğ°Ğ·Ñƒ ÑƒĞ´Ğ°Ğ»ÑĞµĞ¼ Ğ°Ñ€Ñ…Ğ¸Ğ²

      - name: ğŸ“¦ Download Android export templates
        run: |
          curl -L -o templates.tpz https://downloads.tuxfamily.org/godotengine/4.4.1/Godot_v4.4.1-stable_export_templates.tpz
          unzip templates.tpz -d templates
          cp -r templates/export_templates/* ~/.local/share/godot/templates/4.4.1.stable/
          rm -rf templates.tpz templates  # ğŸ§¹ ÑƒĞ´Ğ°Ğ»ÑĞµĞ¼ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹

      - name: ğŸ› ï¸ Export Android Debug APK
        run: |
          mkdir -p bin
          ./Godot_v4.4.1-stable_linux.headless.64 --export-debug "Android" ./bin/game-debug.apk -v

      - name: ğŸ§¹ Clean up Godot binary to free space
        run: |
          rm -f Godot_v4.4.1-stable_linux.headless.64

      - name: ğŸ“¤ Upload APK artifact
        uses: actions/upload-artifact@v4
        with:
          name: android-debug-apk
          path: ./bin/game-debug.apk
